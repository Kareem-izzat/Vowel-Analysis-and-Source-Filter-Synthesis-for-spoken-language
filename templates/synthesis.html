{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center mt-4">
    <div class="col-lg-10">
        
        <div class="card soft mb-4">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
                <div>
                    <p class="eyebrow mb-1 text-uppercase">Part C ‚Äî Source‚ÄìFilter Synthesis</p>
                    <h4 class="mb-1">Generate synthetic vowels (impulse-train source + formant filters)</h4>
                    <p class="text-muted mb-0 small">Defaults: fs=16kHz, duration=1s, presets for /i e a o u/. Optional comparison to natural vowels.</p>
                </div>
            </div>
            <form method="POST" class="mt-3">
                <label class="form-label">Natural vowel folder (optional, e.g., Data)</label>
                <input name="natural_path" class="form-control" placeholder="Data" value="{{ natural_path or '' }}">
                <div class="text-muted small mt-1">If provided, the first .wav under each vowel subfolder will be used for vowel-space comparison.</div>
                <button class="btn btn-primary mt-3">üéõÔ∏è Run Synthesis</button>
            </form>
        </div>

        {% if synth_rows %}
        <div class="card soft mb-4">
            <p class="eyebrow text-uppercase mb-1">Synthetic tokens</p>
            <h5 class="mb-2">WAVs + waveform/spectrogram checks</h5>
            <div class="row g-3">
                {% for r in synth_rows %}
                <div class="col-md-6">
                    <div class="spectro-card h-100">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <span class="badge bg-primary-subtle text-primary me-2">/{{ r['Vowel'] }}/</span>
                                <strong>F1={{ "%.0f"|format(r['F1']) }}, F2={{ "%.0f"|format(r['F2']) }}</strong>
                                <div class="text-muted small">F0={{ "%.0f"|format(120) }} Hz preset</div>
                            </div>
                            <audio controls preload="none" class="audio-compact">
                                <source src="{{ url_for('static', filename=r['WavRel']) }}" type="audio/wav">
                            </audio>
                        </div>
                        <div class="lazy-shell">
                            <img src="{{ url_for('static', filename=r['PlotRel']) }}"
                                 data-src="{{ url_for('static', filename=r['PlotRel']) }}"
                                 loading="lazy"
                                 class="img-fluid rounded-4 border shadow-sm w-100">
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- PART C COMPARISON SECTION - Always show if comparison files exist -->
        <div class="card soft mb-4">
            <p class="eyebrow text-uppercase mb-1">Part C: Detailed Comparison</p>
            <h5 class="mb-2">Synthetic vs Natural Vowels (2 Samples Each)</h5>
            
            <div class="mb-4">
                <h6>Vowel Space - All Samples</h6>
                <img src="{{ url_for('static', filename='synth_outputs/comparisons/vowel_space_all_samples.png') }}" 
                     class="img-fluid rounded-4 border shadow-sm mb-3"
                     onerror="this.parentElement.innerHTML='<p class=text-muted>Comparison plot not found. Run: <code>python run_comparison.py</code></p>'">
            </div>
            
            <div class="mb-4">
                <h6>Formant Error Analysis</h6>
                <div class="table-responsive">
                    <table class="table table-bordered table-sm">
                        <thead>
                            <tr>
                                <th>Vowel</th>
                                <th>Synth F1</th>
                                <th>Synth F2</th>
                                <th>Avg Natural F1</th>
                                <th>Avg Natural F2</th>
                                <th>F1 Error (Hz)</th>
                                <th>F2 Error (Hz)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>i</td><td>424.2</td><td>1216.5</td><td>847.3</td><td>2278.0</td><td>423.1</td><td>1061.4</td></tr>
                            <tr><td>e</td><td>514.7</td><td>1379.3</td><td>459.1</td><td>2073.9</td><td>55.6</td><td>694.6</td></tr>
                            <tr><td>a</td><td>814.4</td><td>1192.1</td><td>748.2</td><td>1215.3</td><td>66.2</td><td>23.2</td></tr>
                            <tr><td>o</td><td>513.9</td><td>905.1</td><td>500.7</td><td>1262.0</td><td>13.2</td><td>356.9</td></tr>
                            <tr><td>u</td><td>405.1</td><td>732.3</td><td>587.8</td><td>1548.6</td><td>182.8</td><td>816.3</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-muted small">
                    <strong>Average Errors:</strong> F1 = 148.1 Hz, F2 = 590.5 Hz
                </p>
            </div>
            
            <h6 class="mb-3">Individual Vowel Comparisons</h6>
            <div class="row g-4">
                <div class="col-12">
                    <div class="spectro-card">
                        <h6><span class="badge bg-success-subtle text-success">/i/</span> Comparison</h6>
                        <img src="{{ url_for('static', filename='synth_outputs/comparisons/comparison_i.png') }}" 
                             class="img-fluid rounded-4 border shadow-sm w-100" loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="col-12">
                    <div class="spectro-card">
                        <h6><span class="badge bg-success-subtle text-success">/e/</span> Comparison</h6>
                        <img src="{{ url_for('static', filename='synth_outputs/comparisons/comparison_e.png') }}" 
                             class="img-fluid rounded-4 border shadow-sm w-100" loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="col-12">
                    <div class="spectro-card">
                        <h6><span class="badge bg-success-subtle text-success">/a/</span> Comparison</h6>
                        <img src="{{ url_for('static', filename='synth_outputs/comparisons/comparison_a.png') }}" 
                             class="img-fluid rounded-4 border shadow-sm w-100" loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="col-12">
                    <div class="spectro-card">
                        <h6><span class="badge bg-success-subtle text-success">/o/</span> Comparison</h6>
                        <img src="{{ url_for('static', filename='synth_outputs/comparisons/comparison_o.png') }}" 
                             class="img-fluid rounded-4 border shadow-sm w-100" loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="col-12">
                    <div class="spectro-card">
                        <h6><span class="badge bg-success-subtle text-success">/u/</span> Comparison</h6>
                        <img src="{{ url_for('static', filename='synth_outputs/comparisons/comparison_u.png') }}" 
                             class="img-fluid rounded-4 border shadow-sm w-100" loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}
